# https://innate-clove-c5b.notion.site/Cosine-Similarity-664f643b74a54a338065b7a3869576ab(ë‚´ ë…¸ì…˜ -> ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì •ë¦¬)



#------------------------------------------ğŸ”°ğŸ”°ğŸ”°ğŸ”°ğŸ”° ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì´ìš©í•˜ê¸°. ğŸ”°ğŸ”°ğŸ”°ğŸ”°ğŸ”°------------------------------------------------
# íŒŒì¼ Data_collection.pyì„ ë³´ë©´ ë°ì´í„°ë¥¼ ëª¨ìœ¼ëŠ” ê³¼ì •ì—ì„œ í•˜ë‚˜ì˜ ì»¬ëŸ¼ì„ ìƒì„±í•˜ì—¬ ë°ì´í„°ë¥¼ ëª°ì•„ë„£ì—ˆìŠµë‹ˆë‹¤.
# ìš°ë¦¬ê°€ ì›í•˜ëŠ” ì§€ì—­ë§Œì„ ë§µí•‘í•˜ì—¬ ë§Œë“  ë°ì´í„°ì˜ ì»¬ëŸ¼ë“¤ì¤‘, 'ì¤‘ë¶„ë¥˜ëª…'ê³¼ 'ì†Œë¶„ë¥˜ëª…'ì€ í™œìš©ê°€ì¹˜ê°€ í° ë°ì´í„°ì…ë‹ˆë‹¤.
# ì´ ë°ì´í„°ë“¤ì„ Cartegory ë°ì´í„°ë¼ê³  ì§€ì¹­í•˜ê² ìŠµë‹ˆë‹¤.


#â— ìœ„ì—ì„œ ì–¸ê¸‰í•œ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë“¤ì˜ ëª¨ìŠµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
#->ì–‘ì‹            ì •í†µì–‘ì‹/ê²½ì–‘ì‹  
#->ì»¤í”¼ì /ì¹´í˜     ì»¤í”¼ì „ë¬¸ì /ì¹´í˜/ë‹¤ë°©
#->í•œì‹           í•œì‹/ë°±ë°˜/í•œì •ì‹


#â—ì´ëŸ° í‚¤ì›Œë“œë¥¼ ë‹´ì€ ë°ì´í„°ë“¤ì„ í•˜ë‚˜ì˜ ì»¬ëŸ¼ì— ëª°ì•„ë‘ë©´ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
#->ì–‘ì‹            ì •í†µì–‘ì‹/ê²½ì–‘ì‹          ------------> ì–‘ì‹ ì „í†µì–‘ì‹ ê²½ì–‘ì‹
#->ì»¤í”¼ì /ì¹´í˜     ì»¤í”¼ì „ë¬¸ì /ì¹´í˜/ë‹¤ë°©      ------------> ì»¤í”¼ì  ì¹´í˜ ì»¤í”¼ì „ë¬¸ì  ì¹´í˜ ë‹¤ë°©
#->í•œì‹           í•œì‹/ë°±ë°˜/í•œì •ì‹           ------------> í•œì‹ í•œì‹ ë°±ë°˜ í•œì •ì‹


#â— df['í•©ì¹œë°ì´í„°'] ë¼ëŠ” ì»¬ëŸ¼ì„ ìƒì„±í•˜ì—¬ ì—¬ê¸°ì— 
# select_df['ì—…ì¢…ì¤‘ë¶„ë¥˜ëª…'] + select_df['ì—…ì¢…ì†Œë¶„ë¥˜ëª…'] +select_df['í‘œì¤€ì‚°ì—…ë¶„ë¥˜ëª…'] ì˜ ê°’ì„ ë„£ì–´ë†¨ìŠµë‹ˆë‹¤.


# ì •ë¦¬ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ì‹¤í–‰í•˜ì—¬ ë´…ì‹œë‹¤.
import re
import pandas as pd
import numpy as np

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
url = r'C:\Users\j.park\Section3\real_project3\create_csv\cleaned_Data.csv'
df = pd.read_csv(url, encoding='utf-8')




# 6ì›” 27ì¼ : ìœ ì‚¬ë„ë¥¼ ì´ìš©í•œ ì¶”ì²œ ì‹œìŠ¤í…œ ë§Œë“¤ê¸°.

from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity


# column : 'í•©ì¹œë°ì´í„°' ì— ëŒ€í•˜ì—¬ TF-IDFë¥¼ êµ¬í•œ ì´í›„ í–‰ë ¬ì˜ í¬ê¸° ì¶œë ¥.

tfidf = TfidfVectorizer()
tfidf_matrix = tfidf.fit_transform(df['í•©ì¹œë°ì´í„°'])
print('tf-idf í–‰ë ¬ì˜ í¬ê¸°(shape):', tfidf_matrix.shape) # tf-idf í–‰ë ¬ì˜ í¬ê¸°(shape): (278, 83)


# ğŸ¤” what is means that 'tf-idf shape'
# 1. 278ê°œì˜ ê°€ê²Œë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ì„œ ì´ 83ê°œì˜ ë‹¨ì–´ë¥¼ ì‚¬ìš©í–ˆìŒì„ ì˜ë¯¸í•œë‹¤.
# 2. ë˜ëŠ” 83ì°¨ì›ì˜ ë¬¸ì„œ ë²¡í„°ê°€ 278ê°œ ì¡´ì¬í•œë‹¤ê³ ë„ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.


# ğŸ¤— 278ê°œì˜ ë¬¸ì„œ ë²¡í„°ì— ëŒ€í•´ì„œ ìƒí˜¸ ê°„ì˜ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ êµ¬í•˜ê¸°.
cosine_sim = cosine_similarity(tfidf_matrix, tfidf_matrix)
print('ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê²°ê³¼ :', cosine_sim.shape)  # ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê²°ê³¼ : (278, 278)


# â—ê²°ê³¼â—
# 1. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì—°ì‚° ê²°ê³¼ë¡œëŠ” 278í–‰, 278ì—´ì˜ í–‰ë ¬ì„ ì–»ìŠµë‹ˆë‹¤.
# 2. ì´ëŠ” 278ê°œì˜ ê° ë¬¸ì„œ ë²¡í„°(ê°€ê²Œì˜ ì—…ì¢… ë¶„ë¥˜ëª…ì„ ëª¨ë‘ í•©ì¹œ ì»¬ëŸ¼)ì™€ ìê¸° ìì‹ ì„ í¬í•¨í•œ 278ê°œì˜ ë¬¸ì„œ ë²¡í„°ê°„ì˜ ìœ ì‚¬ë„ê°€ ê¸°ë¡ëœ í–‰ë ¬ì´ë‹¤.
# 3. 278ê°œì˜ ë¶„ë¥˜ëª…ì˜ ìƒí˜¸ ìœ ì‚¬ë„ê°€ ëª¨ë‘ ê¸°ë¡ë˜ì–´ì ¸ ìˆë‹¤.



# ğŸ¤¨ ê¸°ì¡´ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œë¶€í„° 'ìƒí˜¸ëª…' : 'key', 'ê°€ê²Œì˜ ì¸ë±ìŠ¤' : 'value' ë¡œ í•˜ëŠ” ë”•ì…”ë„ˆë¦¬ ìƒì„±
# dict => title_to_index

title_to_index = dict(zip(df['ìƒí˜¸ëª…'], df.index))

# ê°€ê²Œ ì´ë¦„ 'Bhcì¹˜í‚¨' ì˜ ì¸ë±ìŠ¤ ë¦¬í„´ 
idx = title_to_index['Bhcì¹˜í‚¨'] #  print(idx)ëŠ” 36ì˜ ê°’ì„ ì§€ë‹Œë‹¤.


# ì„ íƒí•œ ì˜í™”ì˜ ì œëª©ì„ ì…ë ¥í•˜ë©´ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ í†µí•´ ğŸ”±ê°€ê²Œì˜ ì—…ì¢… ë¶„ë¥˜ëª…ì„ ëª¨ë‘ í•©ì¹œ ì»¬ëŸ¼ : í•©ì¹œë°ì´í„°ğŸ”±
# ì™€ ê°€ì¥ ìœ ì‚¬í•œ 10ê°œì˜ ì˜í™”ë¥¼ ì°¾ì•„ë‚´ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì.

def get_recommendations(title, cosine_sim=cosine_sim):
    
    # ì„ íƒí•œ ì˜í™”ì˜ íƒ€ì´í‹€ë¡œë¶€í„°  í•´ë‹¹ ì˜í™”ì˜ ì¸ë±ìŠ¤ë¥¼ ë°›ì•„ì˜¤ê¸°.
    idx = title_to_index[title]
    
    # í•´ë‹¹ ì˜í™”ì™€ ëª¨ë“  ì˜í™”ì™€ì˜ ìœ ì‚¬ë„ë¥¼ ê°€ì ¸ì˜¤ê¸°.
    sim_scores = list(enumerate(cosine_sim[idx]))

    # ìœ ì‚¬ë„ì— ë”°ë¼ ì˜í™”ë“¤ì„ ì •ë ¬í•œë‹¤.
    sim_scores = sorted(sim_scores, key=lambda x: x[1], reverse=True)

    # ê°€ì¥ ìœ ì‚¬í•œ 10ê°œì˜ ì˜í™”ë¥¼ ë°›ì•„ì˜¨ë‹¤.
    sim_scores =sim_scores[1:11]
    
    # ê°€ì¥ ìœ ì‚¬í•œ 10ê°œì˜ ì˜í™”ì˜ ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
    movie_indices = [idx[0] for idx in sim_scores]
    
    # ê°€ì¥ ìœ ì‚¬í•œ 10ê°œì˜ ì˜í™” ì œëª©ì„ ë¦¬í„´í•œë‹¤.
    return df['ìƒí˜¸ëª…'].iloc[movie_indices]

breakpoint()





#--- â— ê°ì •ë¶„ì„ ê¸°ë²•
#--- ìš°ë¦¬ê°€ ê°€ì ¸ì˜¨ ë¦¬ë·°ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ë¦¬ë·°ì˜ í…ìŠ¤íŠ¸ê°€ ê¸ì •ì¸ì§€ ë¶€ì •ì¸ì§€ ë¶„ë¥˜í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.





#------- 6ì›” 27ì¼ ì „ ìƒì„± ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.



# #3. ì´ 3ê°œì˜ ê°’ì´ í•©ì³ì§„ ì»¬ëŸ¼ : ['í•©ì¹œë°ì´í„°'] ì„ ì´ìš©í•˜ì—¬ 'í”¼ì²˜ ë²¡í„°í™”'í•˜ê³  ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. / ì‚¬ì´í‚·ëŸ°.

# from sklearn.feature_extraction.text import CountVectorizer  # í”¼ì²´ ë²¡í„°í™”
# from sklearn.metrics.pairwise import cosine_similarity # ì½”ì‚¬ì¸ ìœ ì‚¬ë„

# #ğŸ”†CountVectorizer 
# # 1. ë¬¸ì„œë¥¼ í† í° ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•œë‹¤.
# # 2. ê° ë¬¸ì„œì—ì„œ í† í°ì˜ ì¶œí˜„ ë¹ˆë„ë¥¼ ì„¼ë‹¤.
# # 3. ê° ë¬¸ì„œë¥¼ BOW ì¸ì½”ë”© ë²¡í„°ë¡œ ë³€í™˜í•œë‹¤.

# count_vect_category = CountVectorizer(min_df=0, ngram_range=(1,2))

# # min_df : ë‹¨ì–´ì¥ì— í¬í•¨ë˜ê¸° ìœ„í•œ ìµœì†Œ ë¹ˆë„ (â€» ê¸°ë³¸ê°’ : 1)
# # ngram_range:  n-ê·¸ë¨ ë²”ìœ„ë¡œ ë‹¨ì–´ë¥¼ ëª‡ ê°œë¡œ í† í°í™” í• ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.






# place_category = count_vect_category.fit_transform(df['í•©ì¹œë°ì´í„°']) 
# place_simi_cate = cosine_similarity(place_category, place_category) 
# place_simi_cate_sorted_ind = place_simi_cate.argsort()[:, ::-1]


# applied_cosine_category = cosine_similarity(place_category, place_category)
# place_simi_cate_sorted_ind = applied_cosine_category.argsort()[:, ::-1]

# # ì´ë ‡ê²Œ í•˜ë©´, ê°ê°ì˜ ë°ì´í„° vs ë°ì´í„°ë“¤ì´ ì„œë¡œ ì¹´í…Œê³ ë¦¬ í…ìŠ¤íŠ¸ê°€ ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œì§€ë¥¼ ë”°ì ¸ì¤ë‹ˆë‹¤.
# # 500ê°œì˜ ë°ì´í„°ê°€ ìˆë‹¤ë©´ 1ë²ˆì€ ìê¸° ìì‹ ê³¼ í•œ ë²ˆ ë¹„êµí•˜ê³ , ë‚˜ë¨¸ì§€ 499ê°œì™€ ë¹„êµë¥¼ í•˜ê²Œ ë©ë‹ˆë‹¤.
# # ì´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ ìµœì¢… ì±„ì  ë‹¨ê³„ì—ì„œ í™œìš©í•©ë‹ˆë‹¤.




# # df['í•©ì¹œë°ì´í„°']ë¥¼ ì´ìš©í•˜ì—¬ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í–ˆë˜ ê²ƒì²˜ëŸ¼ ë¦¬ë·° í…ìŠ¤íŠ¸ ì»¬ëŸ¼ì„ ì´ìš©í•˜ì—¬ ê°™ì€ ì‘ì—…ì„ ì§„í–‰í•˜ì—¬ ì¤ë‹ˆë‹¤.

# # ë¦¬ë·° í…ìŠ¤íŠ¸ ì»¬ëŸ¼ ê°„ì˜ í…ìŠ¤íŠ¸ í”¼ì³ë¥¼ ë²¡í„°ë¼ì´ì§•í•©ë‹ˆë‹¤.
# count_vect_review = CountVectorizer(min_df=2, ngram_range = (1,2))
# place_review = count_vect_review.fit_transform(df['ë°©ë¬¸ì_ë¦¬ë·°'])

# # ë¦¬ë·° í…ìŠ¤íŠ¸ ê°„ì˜ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ë”°ì ¸ì¤ë‹ˆë‹¤.
# place_simi_review = cosine_similarity(place_review, place_review)
# place_simi_review_sorted_ind = place_simi_review.argsort()[:,::-1]



# # ì´í›„ ë‹¤ì–‘í•œ ìš”ì†Œë¥¼ ì¢…í•©í•˜ëŠ” ì‹ì„ ê³„ì‚°í•˜ì—¬ ì•Œê³ ë¦¬ì¦˜ì— ì ìš©í•˜ì—¬ ì¤ë‹ˆë‹¤.
# """
# ê³µì‹ 1: ì¹´í…Œê³ ë¦¬ê°€ ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œì§€
# ê³µì‹ 2: í…ìŠ¤íŠ¸ ë¦¬ë·°ê°€ ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œê°€
# ê³µì‹ 3: í…ìŠ¤íŠ¸ ë¦¬ë·°ê°€ ì˜¬ë¼ì˜¨ ê°œìˆ˜
# ê³µì‹ 4: ê°€ê²Œ í‰ì 
# ê³µì‹ 5: ê°€ê²Œ ë³„ì  í‰ê°€ì— ì–¼ë§ˆë‚˜ ë§ì€ ì¸ì›ì´ ì°¸ì—¬í•˜ì˜€ëŠ”ì§€ 
# """
#  # 'ì»¬ëŸ¼ : í•©ì¹œ ë°ì´í„°' ì— ëŒ€í•œ ì¹´í…Œê³ ë¦¬ ìœ ì‚¬ë„
#  # 'ì»¬ëŸ¼ : ë°©ë¬¸ì_ë¦¬ë·°'ì— ëŒ€í•œ ì¹´í…Œê³ ë¦¬ ìœ ì‚¬ë„
#  # ë°©ë¬¸ì ë¦¬ë·°ê°€ ë‹¬ë¦° ì´ ê°œìˆ˜
 
# applied_formula = (place_simi_cate* 0.3
#                    + place_simi_review * 1 
#                    + np.repeat([df['ë¦¬ë·°_ì´ì¸ì›'].values], len(df['ë¦¬ë·°_ì´ì¸ì›']), axis=0) * 0.001 
#                    + np.repeat([df['ê°€ê²Œ_í‰ì '].values], len(df['ê°€ê²Œ_í‰ì ']), axis=0) *0.005
#                    + np.repeat([df['í‰ì ì—_ì°¸ì—¬í•œ_ì¸ì›'].values], len('í‰ì ì—_ì°¸ì—¬í•œ_ì¸ì›'), axis=0) * 0.001)


# place_simi_co_sorted_ind = applied_formula.argsort()[:,::-1]

# #í•¨ìˆ˜ êµ¬í˜„
# def find_place(df,sorted_ind, place_name, top_n=10):
#     place_title = df[df['ìƒí˜¸ëª…'] == place_name]
#     place_index = place_title.index.values
#     similar_indexes = sorted_ind[place_index, :(top_n)]
#     similar_indexes = similar_indexes.reshape(-1)
#     return df.iloc[similar_indexes]


# breakpoint()


# # â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—ë¬¸ì œì  ë°œê²¬â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—
# # ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì ìš©ì‹œ, ì ìš©ë˜ëŠ” ë°ì´í„° ì»¬ëŸ¼ì— np.nanì˜ ê°’ì´ ì¡´ì¬í•˜ë©´ ì•ˆëœë‹¤.
# #df['ë°©ë¬¸ì_ë¦¬ë·°']ì— ì ìš©í•˜ëŠ” ë„ì¤‘  
# # ValueError: np.nan is an invalid document, expected byte or unicode string. ì˜ ì˜¤ë¥˜ê°€ ë– ì„œ ê°’ì´ ì—†ëŠ” ë¶€ë¶„ì€ 'ì—†ìŒ'ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤.
# # data_cleaningì— ì ìš©í•˜ë„ë¡ í•˜ì.